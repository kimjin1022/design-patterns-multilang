name: Multi-language Design Patterns Build

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:
  release:
    types: [created]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install compilers
        run: |
          sudo apt update
          sudo apt install -y g++ mono-mcs default-jdk

      - name: Compile C++ files
        run: |
          mkdir -p bin/cpp
          for file in cpp/*.cpp; do
            g++ "$file" -o "bin/cpp/$(basename ${file%.cpp})"
          done

      - name: Compile C# files
        run: |
          mkdir -p bin/csharp
          for file in csharp/*.cs; do
            mcs "$file" -out:"bin/csharp/$(basename ${file%.cs}).exe"
          done

      - name: Compile Kotlin files
        run: |
          mkdir -p bin/kotlin
          for file in kotlin/*.kt; do
            kotlinc "$file" -include-runtime -d "bin/kotlin/$(basename ${file%.kt}).jar"
          done

      - name: Create ZIP archive
        if: github.event_name == 'release'
        run: zip -r compiled_outputs.zip bin/

      - name: Upload artifact
        if: github.event_name == 'release'
        uses: actions/upload-artifact@v3
        with:
          name: compiled_outputs
          path: compiled_outputs.zip